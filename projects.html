<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Tuna | Projects</title>

  <!-- Bootstrap + Mobirise theme -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mobirise-icons@2.0.0/mobirise2.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mobirise/mobirise5@main/m5-theme/css/style.css">
  <link rel="stylesheet" href="style.css">

  <style>
    /* Shared pill style (colour comes from JS) */
    .badge.tag-pill{border:1px solid currentColor;border-radius:9999px;padding:.35em .6em;font-weight:500;background:transparent}
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="bg-white shadow p-4 d-flex justify-content-between align-items-center">
  <h1 class="h4 fw-bold mb-0">Tuna</h1>
  <ul class="d-flex gap-3 list-unstyled mb-0">
    <li><a href="index.html" class="text-decoration-none">Home</a></li>
    <li><a href="cv.html" class="text-decoration-none">CV</a></li>
    <li><a href="projects.html" class="text-decoration-none fw-semibold">Projects</a></li>
  </ul>
</nav>

<section class="py-5 text-center">
  <div class="container">
    <h2 class="display-5 fw-bold">My Projects</h2>
  </div>
</section>

<!-- Filter bar -->
<section class="py-3">
  <div class="container d-flex flex-wrap align-items-center gap-3">
    <div class="input-group" style="max-width:220px;">
      <label class="input-group-text" for="sortSelect">Sort</label>
      <select class="form-select" id="sortSelect">
        <option value="az" selected>A - Z</option>
        <option value="za">Z - A</option>
      </select>
    </div>
    <div id="tagFilters" class="d-flex flex-wrap gap-2"></div>
  </div>
</section>

<!-- Dynamic Project Grid -->
<section class="article07 my-5">
  <div class="container">
    <div class="row g-4" id="projectGrid">
      <!-- JS will populate cards here -->
    </div>
  </div>
</section>

<section class="py-5">
  <div class="container">
    <div class="rounded-4 border border-2 border-dashed border-secondary bg-light text-center py-5">
      <h4 class="h5 fw-semibold text-secondary mb-2">More Projects Coming Soon</h4>
      <p class="text-muted mb-0">Stay tuned for upcoming work.</p>
    </div>
  </div>
</section>

<footer class="text-center py-4 border-top"><small class="text-muted">© 2025 Tuna Gökgöz</small></footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- ========= Dynamic JSON, Tag & Filter Logic ========= -->
<script type="module">
  import { TAGS, colourOfIndex } from './assets/tags.js';
  const grid = document.getElementById('projectGrid');
  const bar = document.getElementById('tagFilters');
  const sortSelect = document.getElementById('sortSelect');
  let activeTag = new URLSearchParams(window.location.search).get('tag') || 'all';

  // Create filter buttons
  ['all', ...TAGS.map(t => t.id)].forEach((tag, i) => {
    const btn = document.createElement('button');
    btn.className = i === 0 ? 'btn btn-secondary btn-sm active' : 'btn btn-outline-secondary btn-sm';
    btn.dataset.tag = tag;
    btn.textContent = tag === 'all' ? 'All' : TAGS.find(t => t.id === tag).label;
    bar.appendChild(btn);
  });

  // Fetch projects.json and render
  fetch('./projects.json')
    .then(res => res.json())
    .then(list => {
      // Populate grid
      list.forEach(p => {
        const col = document.createElement('div');
        col.className = 'col-12';
        col.innerHTML = `
          <div class="card shadow-lg rounded-4 overflow-hidden p-4 position-relative"
               data-title="${p.title}"
               data-tags="${p.tags.join(',')}">
            <a href="${p.url}" class="stretched-link"><span class="visually-hidden">Open ${p.title} project</span></a>
            <h3 class="h5 fw-bold mb-2">${p.title}</h3>
            <p class="mb-2">${p.description}</p>
          </div>`;
        grid.appendChild(col);
      });
      initControls();
    })
    .catch(err => console.error('Error loading projects:', err));

  function initControls() {
    // Highlight active tag button
    if (activeTag !== 'all') {
      bar.querySelectorAll('button').forEach(b => b.classList.toggle('active', b.dataset.tag === activeTag));
    }

    // Render badges and filter
    function render() {
      const cards = Array.from(grid.querySelectorAll('.card'));
      cards.forEach(card => {
        // Add badges if missing
        if (!card.querySelector('.tag-badges')) {
          const wrapper = document.createElement('p');
          wrapper.className = 'mt-3 tag-badges';
          card.dataset.tags.split(',').map(t => t.trim()).forEach(id => {
            const idx = TAGS.findIndex(t => t.id === id);
            const { text, fill } = colourOfIndex(idx);
            const span = document.createElement('span');
            span.className = 'badge tag-pill me-1';
            span.style.color = text;
            span.style.background = fill;
            span.textContent = TAGS[idx].label;
            wrapper.appendChild(span);
          });
          card.appendChild(wrapper);
        }
        // Filter display
        const tags = card.dataset.tags.split(',').map(t => t.trim());
        card.parentElement.style.display = activeTag === 'all' || tags.includes(activeTag) ? '' : 'none';
      });
    }

    // Tag click handler
    bar.addEventListener('click', e => {
      if (!e.target.dataset.tag) return;
      activeTag = e.target.dataset.tag;
      bar.querySelectorAll('button').forEach(b => b.classList.toggle('active', b === e.target));
      render();
    });

    // Sort handler
    sortSelect.addEventListener('change', e => {
      const asc = e.target.value === 'az';
      const cols = Array.from(grid.querySelectorAll('.col-12'));
      cols.sort((a, b) => {
        const aT = a.querySelector('.card').dataset.title.toLowerCase();
        const bT = b.querySelector('.card').dataset.title.toLowerCase();
        return asc ? aT.localeCompare(bT) : bT.localeCompare(aT);
      }).forEach(col => grid.appendChild(col));
      render();
    });

    // Initial render
    render();
  }
</script>

</body>
</html>
